---
title: "filter_eBird_sampling"
author: "N.M. Tarr"
date: "2/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview
The eBird sampling dataset can be downloaded from eBird, but includes many records that are not relevant for the NCBA.  Therefore, checklist records of interest must be extracted.  The auk package provides a way to do this and saves the desirable records as a text file that can be read by other scripts.  This markdown performs the filtering.

Load the necessary R packages.
```{r}
library(auk)
library(tidyverse)
```

Set some paths.
```{r}
# set a path for an output file
output_file <- "/users/nmtarr/Documents/NCBA/Data/filtered_checklists.txt"

# print path to sampling data set
sampling_file <- "/Volumes/eBird/ebd_sampling_relDec-2020/ebd_sampling_relDec-2020.txt"
print(sampling_file)
```

Set the criteria for filtering.
```{r}
state <- "US-NC"
country <- "US"
date <- c("2015-01-01", "2021-12-31")
```

Filter the sampling data and save results to the output file. Note that only complete checklists are returned.
```{r}
effort_data <- auk_sampling(sampling_file) %>%
  # define filters
  auk_date(date=date) %>%
  auk_country(country=country) %>%
  auk_state(state=state) %>%
  auk_complete() %>%
  # run filtering
  auk_filter(file=output_file, 
             overwrite=TRUE,
             drop=c("Country Code", "State Code", "country", "State")
             ) %>%
  read_sampling()
```

Write to a csv file as well.
```{r}
write_csv(effort_data, "/users/nmtarr/Documents/NCBA/Data/filtered_checklists.csv")
```


Now explore the filtered checklist records in another script (.R or .rmd file).